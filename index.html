<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Listing Generator</title>
    <meta name="description" content="Generate marketplace listings from photos">
    <meta name="theme-color" content="#3B82F6">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkFJIExpc3RpbmcgR2VuZXJhdG9yIiwKICAic2hvcnRfbmFtZSI6ICJMaXN0aW5nIEFJIiwKICAiZGVzY3JpcHRpb24iOiAiR2VuZXJhdGUgbWFya2V0cGxhY2UgbGlzdGluZ3MgZnJvbSBwaG90b3MiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzQjgyRjYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnJTIwdmlld0JveCUzRCcwJTIwMCUyMDI0JTIwMjQnJTIweG1sbnMlM0QnaHR0cCUzQSUyRiUyRnd3dy53My5vcmclMkYyMDAwJTJGc3ZnJyUzRSUzQ3BhdGglMjBkJTNEJ201JTIwMTNoMTRsLTklMjA5JTIwOWwtOS05JTIwNC00aDJ2LTJoLTJ2LTFoLTJsLTQtNGgtMnYtMWgtMnYtMmw0LTRoMnYtMWgydjJoMmw0JTIwNGgydjFoMnYyaC0ydjJoLTJsLTQlMjA0aC0ydjFoLTJ2LTJoLTJsLTQtNGgtMnYtMWgtMnYyaC0yeiclMkYlM0UlM0MlMkZzdmclM0UiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiCiAgICB9CiAgXQp9">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m5 13h14l-9 9 9l-9-9 4-4h2v-2h-2v-1h-2l-4-4h-2v-1h-2v-2l4-4h2v-1h2v2h2l4 4h2v1h2v2h-2v2h-2l-4 4h-2v1h-2v-2h-2l-4-4h-2v-1h-2v2h-2z'/%3E%3C/svg%3E">
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1f2937;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 100%;
            padding: 1rem;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
        }
        
        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .settings-btn {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #f3f4f6;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 100;
        }
        
        .alert {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            display: none;
        }
        
        .alert.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .alert.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .settings-panel {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: none;
        }
        
        .upload-area {
            background: white;
            border: 2px dashed #d1d5db;
            border-radius: 0.75rem;
            padding: 2rem 1rem;
            text-align: center;
            margin-bottom: 1.5rem;
            transition: border-color 0.2s;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .upload-area:active {
            border-color: #3b82f6;
        }
        
        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            color: #9ca3af;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .generate-btn {
            width: 100%;
            background: #16a34a;
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 1rem;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: background 0.2s;
        }
        
        .generate-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .generate-btn:not(:disabled):active {
            background: #15803d;
        }
        
        .tabs {
            display: flex;
            background: #f3f4f6;
            border-radius: 0.5rem;
            padding: 0.25rem;
            margin-bottom: 1rem;
        }
        
        .tab {
            flex: 1;
            background: transparent;
            border: none;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.2s;
        }
        
        .tab.active {
            background: #3b82f6;
            color: white;
        }
        
        .listing-container {
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .listing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .copy-btn {
            background: #f3f4f6;
            border: none;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            color: #374151;
        }
        
        .copy-btn:disabled {
            opacity: 0.5;
        }
        
        .listing-content {
            width: 100%;
            min-height: 300px;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            resize: vertical;
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .input-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }
        
        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        
        .help-text {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .save-btn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .camera-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: #3b82f6;
            border: none;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            z-index: 100;
        }
        
        @media (max-width: 640px) {
            .container {
                padding: 0.5rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .settings-btn {
                width: 44px;
                height: 44px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="settings-btn" onclick="toggleSettings()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        </button>
        
        <div class="header">
            <h1>ðŸ“± AI Listing Generator</h1>
            <p>Take photos, get instant marketplace listings</p>
        </div>
        
        <div id="success-alert" class="alert success"></div>
        <div id="error-alert" class="alert error"></div>
        
        <div id="settings-panel" class="settings-panel">
            <h3 style="margin-bottom: 1rem;">API Settings</h3>
            <div class="input-group">
                <label>Claude API Key</label>
                <input type="password" id="api-key" placeholder="sk-ant-api03-...">
                <p class="help-text">Get your API key from console.anthropic.com</p>
            </div>
            <button class="save-btn" onclick="saveApiKey()">Save API Key</button>
        </div>
        
        <div class="upload-area" onclick="triggerFileInput()">
            <input type="file" id="file-input" accept="image/*" capture="environment" style="display: none;" onchange="handleImageUpload(event)">
            <div id="upload-content">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7,10 12,15 17,10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <p style="font-weight: 600; margin-bottom: 0.5rem;">Take Photo or Upload</p>
                <p style="color: #6b7280; font-size: 0.875rem;">Tap to take photo with camera</p>
            </div>
            <img id="image-preview" class="image-preview" style="display: none;">
        </div>
        
        <button class="generate-btn" id="generate-btn" onclick="generateListings()" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.5 2l-2 2m-2 2l-7 7-2.5-2.5a1.5 1.5 0 0 0-2.121 0l-.879.879A1.5 1.5 0 0 0 5.5 13.5L8 16l7-7 2-2 2-2z"></path>
                <path d="m6 16 2 2 7-7"></path>
            </svg>
            Generate Listings
        </button>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('ebay')">eBay</button>
            <button class="tab" onclick="switchTab('craigslist')">Craigslist</button>
            <button class="tab" onclick="switchTab('facebook')">Facebook</button>
        </div>
        
        <div class="listing-container">
            <div class="listing-header">
                <h3 id="platform-title">eBay Listing</h3>
                <button class="copy-btn" id="copy-btn" onclick="copyToClipboard()" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                    Copy
                </button>
            </div>
            <textarea id="listing-content" class="listing-content" placeholder="Generated listing will appear here..."></textarea>
        </div>
        
        <button class="camera-btn" onclick="triggerCamera()" title="Take Photo">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
        </button>
    </div>

    <script>
        let selectedImage = null;
        let currentPlatform = 'ebay';
        let listings = { ebay: '', craigslist: '', facebook: '' };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const savedApiKey = localStorage.getItem('claude_api_key');
            if (savedApiKey) {
                document.getElementById('api-key').value = savedApiKey;
            }
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript,// PWA Service Worker');
            }
        });
        
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('api-key').value;
            localStorage.setItem('claude_api_key', apiKey);
            toggleSettings();
            showSuccess('API key saved!');
        }
        
        function triggerFileInput() {
            document.getElementById('file-input').click();
        }
        
        function triggerCamera() {
            const input = document.getElementById('file-input');
            input.setAttribute('capture', 'environment');
            input.click();
        }
        
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showError('Image must be under 5MB');
                return;
            }
            
            selectedImage = file;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('image-preview');
                const uploadContent = document.getElementById('upload-content');
                
                preview.src = e.target.result;
                preview.style.display = 'block';
                uploadContent.style.display = 'none';
                
                document.getElementById('generate-btn').disabled = false;
            };
            reader.readAsDataURL(file);
        }
        
        function switchTab(platform) {
            currentPlatform = platform;
            
            // Update tab styles
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update content
            document.getElementById('platform-title').textContent = 
                platform.charAt(0).toUpperCase() + platform.slice(1) + ' Listing';
            document.getElementById('listing-content').value = listings[platform];
            
            // Update copy button state
            document.getElementById('copy-btn').disabled = !listings[platform];
        }
        
        async function generateListings() {
            if (!selectedImage) {
                showError('Please select an image first');
                return;
            }
            
            const apiKey = localStorage.getItem('claude_api_key');
            if (!apiKey) {
                showError('Please set your Claude API key in settings');
                toggleSettings();
                return;
            }
            
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Analyzing Image...';
            
            try {
                const base64Image = await convertImageToBase64(selectedImage);
                
                const prompt = `Analyze this image and create 3 complete marketplace listings:

**EBAY LISTING:**
Title: [Brand] [Model] [Key Feature] - [Condition] (under 80 chars)

Description:
ðŸ”¹ Brand: [Brand from image]
ðŸ”¹ Model: [Model if visible]  
ðŸ”¹ Condition: [Excellent/Very Good/Good/Fair]
ðŸ”¹ Features: [Key selling points]
ðŸ”¹ Includes: [What's in photo]
ðŸ”¹ Notes: [Any wear/damage visible]

Starting Bid: $[conservative price]
Buy It Now: $[market value]

**CRAIGSLIST LISTING:**
Title: [Item] - $[Price] - [Condition]

Selling my [item] due to [upgrade/moving].

Details:
- [Key features from image]
- [Condition assessment]  
- [What's included]
- [Any issues if visible]

$[price] firm/OBO
Cash only, local pickup
Safe meetup location

**FACEBOOK MARKETPLACE:**
Title: [Item] for sale - $[Price]

Hi! Selling this [item] that's been [usage].

âœ… [Selling points from image]
âœ… [Condition highlights]
âœ… [Why good deal]

$[price] - Can meet anywhere local
Cash or Venmo accepted

Message if interested! ðŸ˜Š

PRICING: Quick sale $[X], Fair market $[Y], Optimistic $[Z]

Make ready to copy/paste.`;

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-sonnet-20240229',
                        max_tokens: 3000,
                        messages: [{
                            role: 'user',
                            content: [{
                                type: 'image',
                                source: {
                                    type: 'base64',
                                    media_type: selectedImage.type,
                                    data: base64Image
                                }
                            }, {
                                type: 'text',
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP ${response.status}`);
                }

                const data = await response.json();
                const content = data.content[0].text;
                
                // Parse sections
                const ebayMatch = content.match(/\*\*EBAY LISTING:\*\*(.*?)(?=\*\*CRAIGSLIST|\*\*FACEBOOK|$)/s);
                const craigslistMatch = content.match(/\*\*CRAIGSLIST LISTING:\*\*(.*?)(?=\*\*FACEBOOK|PRICING|$)/s);
                const facebookMatch = content.match(/\*\*FACEBOOK MARKETPLACE:\*\*(.*?)(?=PRICING|$)/s);
                
                listings = {
                    ebay: ebayMatch ? ebayMatch[1].trim() : 'eBay section not found',
                    craigslist: craigslistMatch ? craigslistMatch[1].trim() : 'Craigslist section not found',
                    facebook: facebookMatch ? facebookMatch[1].trim() : 'Facebook section not found'
                };
                
                // Update current view
                document.getElementById('listing-content').value = listings[currentPlatform];
                document.getElementById('copy-btn').disabled = false;
                
                showSuccess('Listings generated! ðŸŽ‰');
                
            } catch (error) {
                showError('Error: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.5 2l-2 2m-2 2l-7 7-2.5-2.5a1.5 1.5 0 0 0-2.121 0l-.879.879A1.5 1.5 0 0 0 5.5 13.5L8 16l7-7 2-2 2-2z"></path>
                        <path d="m6 16 2 2 7-7"></path>
                    </svg>
                    Generate Listings
                `;
            }
        }
        
        async function copyToClipboard() {
            const content = document.getElementById('listing-content').value;
            try {
                await navigator.clipboard.writeText(content);
                showSuccess('Copied to clipboard! ðŸ“‹');
            } catch (err) {
                showError('Failed to copy');
            }
        }
        
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function showSuccess(message) {
            const alert = document.getElementById('success-alert');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);
        }
        
        function showError(message) {
            const alert = document.getElementById('error-alert');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }
        
        // Handle textarea updates
        document.getElementById('listing-content').addEventListener('input', function(e) {
            listings[currentPlatform] = e.target.value;
        });
    </script>
</body>
</html>
